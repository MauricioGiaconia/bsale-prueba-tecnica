<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controllers/getAllTest.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controllers/getAllTest.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const {Airplane, Flight, Seat, Seat_type, Purchase, Passenger, Boarding_pass} = require('../database/db.js');

const {renameKeys} = require('../scripts/functions.js');
const getEmptySeats = require('./getEmptySeats.js');

const getAllAirplanes = async (req, res) => {

    try{
        /** Este arreglo ser치 el retornado y en el se almacenar치 cada dato con sus keys en camelCase 
         * @type {Array}
         */
        let response = {passenger : []};
        let occupiedSeats = [];

        const dbResponse = await Flight.findByPk(1, {include: [
                                                            {
                                                                model: Boarding_pass,
                                                                as: 'boarding_passes',
                                                                include: [
                                                                  { model: Purchase, as: 'purchase' },
                                                                  { model: Passenger, as: 'passenger' },
                                                                  { model: Seat, as: 'seat' },
                                                                  { model: Seat_type, as: 'seat_type' }
                                                                ]
                                                            }
                                                        ]
                                                    });
    
            if (dbResponse) {
       
                for (const data of dbResponse['boarding_passes']){
                 
                  response['passenger'].push({
                    ...data.passenger['dataValues'], 
                    boarding_pass_id: data['boarding_pass_id'],
                    purchase_id: data.purchase['purchase_id'],
                    seat_type_id: data['seat_type_id'],
                    seat_id: data['seat_id']

                  });

                  if (data['seat_id'] !== null){
                    occupiedSeats.push(data['seat_id']);
                  } 
                }
                
                response = {...dbResponse ,...response};
                console.log(await getEmptySeats(1, occupiedSeats), occupiedSeats)
               
                /**
                 * Elimino del objeto a retornar, todas las keys innecesarias para la respuesta
                 */
                delete response.dataValues['boarding_passes'];
                delete response['boarding_passes'];
                delete response['_previousDataValues'];
                delete response['_changed'];
                delete response['uniqno'];
                delete response['_options'];
                delete response['isNewRecord'];

                /**
                 * Los datos del vuelo estan en la key dataValues, por lo tanto, 
                 * unifico la informaci칩n de dataValues y passengers en un unico objeto
                 */
                response = {...response.dataValues, passengers : response.passenger}

                response = renameKeys(response);

                return res.status(200).json({
                  code: 200,
                  data: response
                });
              }

        return res.status(404).json({
            code: 404,
            data: {}
        });
       
    } catch (error){
        return res.status(400).json({error : error.message})
    }
   
}

module.exports = getAllAirplanes;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#define">define</a></li><li><a href="global.html#entries">entries</a></li><li><a href="global.html#getEmptySeats">getEmptySeats</a></li><li><a href="global.html#modelDefiners">modelDefiners</a></li><li><a href="global.html#renameKeys">renameKeys</a></li><li><a href="global.html#retry">retry</a></li><li><a href="global.html#snakeToCamelCase">snakeToCamelCase</a></li><li><a href="global.html#sync">sync</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed Jun 14 2023 00:15:20 GMT-0300 (hora est치ndar de Argentina)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
